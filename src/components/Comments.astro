---
// 这是全新的、强大的、带有“强制命令”和“自动穿衣”功能的 Waline 评论组件！
---

<!-- 1. 这是 Waline 评论区要显示的位置 -->
<div id="waline" class="mx-auto my-16 max-w-4xl px-4"></div>

<!-- 2. 我们把所有魔法都集中在这个脚本里 -->
<script is:inline>
  // 我们创建一个函数，专门负责“召唤”评论区
  const initWaline = () => {
    // 先检查一下，如果评论区已经在了，就不用重复召唤了
    if (document.querySelector('#waline .wl-root')) {
      return;
    }

    // --- 魔法在这里！我们先给它穿上衣服！---
    // 检查一下是不是已经穿过衣服了，没有的话就穿上
    if (!document.querySelector('link[href*="waline.css"]')) {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'https://unpkg.com/@waline/client@v3/dist/waline.css';
      document.head.appendChild(link);
      console.log("Waline: 已为评论区穿上新衣服！");
    }

    // 动态加载 Waline 的脚本，这样最灵活
    import('https://unpkg.com/@waline/client@v3/dist/waline.js').then(({ init }) => {
      console.log("Waline 脚本已加载，开始初始化...");
      init({
        el: '#waline',
        // ↓↓↓ 请再次确认这里的地址是你自己的 Waline 服务器地址！ ↓↓↓
        serverURL: 'https://your-waline-server.vercel.app',
        
        // --- 个性化配置 ---
        lang: 'zh-CN',
        reaction: true,
        pageview: true,
        emoji: [
          'https://unpkg.com/@waline/emojis@1.2.0/weibo',
          'https://unpkg.com/@waline/emojis@1.2.0/bilibili',
        ],
        dark: 'html.dark',
      });
    }).catch(e => console.error('加载 Waline 失败:', e));
  };

  // --- 强制命令来了！---
  // 命令一：当页面切换动画（Swup）完成时，必须召唤评论区！
  document.addEventListener('swup:pageView', initWaline);

  // 命令二：当整个网页第一次加载完成时（不管有没有动画），也必须召唤评论区！
  // 我们用一个延时来确保万无一失，给页面上其他元素一点反应时间
  if (document.readyState === 'complete') {
    setTimeout(initWaline, 100);
  } else {
    window.addEventListener('load', () => {
      setTimeout(initWaline, 100);
    });
  }
</script>
