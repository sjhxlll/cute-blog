---
// src/components/Comments.astro

// 这个组件需要从使用它的地方接收一个 path 属性
// 用来告诉 Twikoo 这是哪一篇文章的评论区
interface Props {
	path: string;
}

// 把配置项先准备好，等下传给客户端脚本
const config = {
	el: "#tcomment", // 这里的 #tcomment 要和下面 div 的 id 一致
	path: Astro.props.path,
};
---

<div id="tcomment"></div>

<script is:inline define:vars={{ config }}>
	// 这是一个小小的“开关”，只有当接收到 "loadComment" 信号时，才执行加载
	// { once: true } 保证这个信号只生效一次，不会重复加载
	document.addEventListener("loadComment", function() {
		// 创建一个 script 标签
		const script = document.createElement("script");
		// 设置 script 标签的源，这里用的是 Twikoo 的 CDN 地址
		script.src = "https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.min.js";

		// 当脚本加载完成后，执行初始化
		script.onload = () => {
			window.twikoo.init({
				// ...config 会把 { el: "#tcomment", path: "..." } 展开在这里
				...config,
				// !!! 这是最重要的一步，把下面这行换成你自己的 Vercel 环境地址 !!!
				envId: "你的 Vercel 环境地址，比如 https://twikoo.aidoi.top",
				lang: "zh-CN", // 设置语言为中文
			});
		};

		// 把创建好的 script 标签插入到页面中，浏览器就会开始下载它啦
		document.body.appendChild(script);
	}, { once: true });
</script>