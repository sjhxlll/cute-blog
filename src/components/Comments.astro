---
// 这是全新的、强大的 Waline 评论组件！
const { lang } = Astro.props;
---

<!-- 1. 引入 Waline 的样式和脚本 -->
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
<script type="module">
  import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';

  // 监听 Astro 的页面加载事件，确保每次翻页都能正确加载评论区
  document.addEventListener('astro:page-load', () => {
    const el = document.querySelector('#waline');
    
    // 如果页面上已经有 Waline 评论区，就先销毁旧的，防止重复
    if (el && el.children.length > 0) {
      // Waline v3 doesn't have a public destroy method exposed, 
      // so we just clear the container.
      el.innerHTML = '';
    }

    // 如果页面上有 #waline 容器，就初始化一个新的 Waline 实例
    if (el) {
      init({
        el: '#waline',
        // ↓↓↓ 在这里粘贴你刚刚部署好的 Vercel 服务器地址！ ↓↓↓
        serverURL: 'https://my-waline-server-psi.vercel.app/', 
        
        // --- 下面是一些个性化配置，你可以自己玩 ---
        lang: 'zh-CN', // 语言
        reaction: true, // 开启表情回应
        pageview: true, // 开启阅读量统计
        emoji: [ // 自定义表情
          'https://unpkg.com/@waline/emojis@1.2.0/weibo',
          'https://unpkg.com/@waline/emojis@1.2.0/alus',
          'https://unpkg.com/@waline/emojis@1.2.0/bilibili',
        ],
        dark: 'html.dark', // 自动适应暗色模式
        meta: ['nick', 'mail', 'link'], // 评论者需要填写的信息
        requiredMeta: ['nick'], // 必填项
        login: 'enable', // 登录模式
        wordLimit: 300, // 字数限制
      });
    }
  });
</script>

<!-- 2. 这是 Waline 评论区要显示的位置 -->
<div id="waline" class="mx-auto my-16 max-w-4xl px-4"></div>
