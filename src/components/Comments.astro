---
// 这是评论区组件的最终版本
---

<!-- 1. 引入 Valine 的核心脚本 -->
<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>

<!-- 2. 这是 Valine 评论区要显示的位置 -->
<div id="vcomments" class="mx-auto my-16 max-w-4xl px-4"></div>

<!-- 
  3. 初始化 Valine 的脚本。
  我们把初始化代码放进一个事件监听器里，
  确保它在整个页面都加载完毕、并且 Astro 的页面切换动画完成后才运行。
  这样就能保证 #vcomments 这个元素一定存在，也能避免和其他脚本打架。
-->
<script is:inline>
  function initValine() {
    // 检查 Valine 是否已经初始化，防止重复加载
    // 如果已经有 .vwrap 元素，说明 Valine 已经渲染了，就不用再执行了
    if (document.querySelector('#vcomments .vwrap')) {
      return;
    }
    
    // 检查 Valine 函数是否存在
    if (typeof Valine === 'function') {
      new Valine({
        el: '#vcomments',
        appId: 'XVu5uGyeWQCUayGYC0wwlg1B-gzGzoHsz',
        appKey: '2nw7sXBAhUf4SimNycb3lmoL',
        placeholder: '有什么问题欢迎评论区留言~么么哒',
        avatar: 'wavatar',
        visitor: true,
      });
    }
  }

  // 监听 Astro 的页面加载事件，这是最稳妥的方式
  document.addEventListener('astro:page-load', initValine);
</script>
