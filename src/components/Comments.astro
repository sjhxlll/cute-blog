---
// 这是评论区组件的终极版本，加入了双重保险！
---

<!-- 1. 引入 Valine 的核心脚本 -->
<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>

<!-- 2. 这是 Valine 评论区要显示的位置 -->
<div id="vcomments" class="mx-auto my-16 max-w-4xl px-4"></div>

<!-- 
  3. 初始化 Valine 的脚本。
  我们现在监听两个信号：
  - 'astro:page-load': 负责第一次打开页面时加载。
  - 'swup:pageView': 负责在用动画切换页面后重新加载，这是专门对付这个模板的终极武器！
-->
<script is:inline>
  function initValine() {
    // 秘密日志，帮我们看到代码有没有在运行
    console.log("开始尝试召唤评论区...");

    const el = document.querySelector('#vcomments');
    if (!el) {
      console.log("召唤失败：没找到安放评论区的#vcomments位置。");
      return;
    }
    
    if (el.querySelector('.vwrap')) {
      console.log("评论区已经在了，不用重复召唤。");
      return;
    }
    
    if (typeof Valine === 'function') {
      console.log("找到了Valine魔法书，开始施法！");
      new Valine({
        el: '#vcomments',
        appId: 'XVu5uGyeWQCUayGYC0wwlg1B-gzGzoHsz',
        appKey: '2nw7sXBAhUf4SimNycb3lmoL',
        placeholder: '有什么问题欢迎评论区留言~么么哒',
        avatar: 'wavatar',
        visitor: true,
      });
      console.log("施法完毕！");
    } else {
      console.log("召唤失败：Valine魔法书还没送到。");
    }
  }

  // 双重保险！同时监听两个信号！
  document.addEventListener('astro:page-load', initValine);
  document.addEventListener('swup:pageView', initValine);
</script>
